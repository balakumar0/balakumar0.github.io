<!DOCTYPE html>
<html>
<head>
    <title>Real-time Object Detection</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"> </script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"> </script>
</head>
<body>
    <video autoplay playsinline id="webcam" style="display:none"></video>
    <canvas id="canvas"></canvas>

    <script>
        const video = document.getElementById('webcam');
        const canvas = document.getElementById('canvas');
        const context = canvas.getContext('2d');

        navigator.mediaDevices.getUserMedia({video: {facingMode: 'environment'}})
            .then(stream => {
                video.srcObject = stream;
                video.onloadedmetadata = () => {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    detectFromVideoFrame(video);
                };
            });

        const modelPromise = cocoSsd.load();

        async function detectFromVideoFrame(video) {
            const model = await modelPromise;
            const predictions = await model.detect(video);

            // Clear previous drawings before new predictions are drawn
            context.clearRect(0, 0, canvas.width, canvas.height);

            context.drawImage(video, 0, 0, video.videoWidth, video.videoHeight);
            predictions.forEach(prediction => {
                context.beginPath();
                context.rect(...prediction.bbox);
                context.lineWidth = 2;
                context.strokeStyle = 'yellow';
                context.fillStyle = 'yellow';
                context.stroke();
                context.fillText(
                    `${prediction.class} (${Math.round(prediction.score * 100)}%)`,
                    prediction.bbox[0],
                    prediction.bbox[1] > 10 ? prediction.bbox[1] - 5 : 10
                );
            });

            requestAnimationFrame(() => detectFromVideoFrame(video));
        }
    </script>
</body>
</html>
